{%- comment %}<locksmith:e0d8>{% endcomment -%}
{%- include 'locksmith' -%}
{%- comment %}</locksmith:e0d8>{% endcomment -%}

<!DOCTYPE html>
<html
  class="min-h-[100vh]"
  lang="{{ request.locale.iso_code }}"
  x-data="app()"
  x-init="
    handleSharedCart(); 
    updateCart(false);">
  <head>
    {{ locksmith_initializations }}
    {% render 'theme__meta' %}
    <link
      rel="preconnect"
      href="https://cdn.shopify.com"
      crossorigin>
    {%- unless settings.type_font_heading.system? and settings.type_font_body.system? -%}
      <link
        rel="preconnect"
        href="https://fonts.shopifycdn.com"
        crossorigin>
    {%- endunless -%}
    {%- unless settings.type_font_body.system? -%}
      <link
        rel="preload"
        as="font"
        href="{{ settings.type_font_body | font_url }}"
        type="font/woff2"
        crossorigin>
    {%- endunless -%}
    {%- unless settings.type_font_heading.system? -%}
      <link
        rel="preload"
        as="font"
        href="{{ settings.type_font_heading | font_url }}"
        type="font/woff2"
        crossorigin>
    {%- endunless -%}
    {% render 'theme__structured-data' %}
    {% render 'theme__styles' %}
    {{ 'styles.css' | asset_url | stylesheet_tag | preload: true }}
    {{ content_for_header }}
    <link
      rel="stylesheet"
      href="{{ 'nf-dialog.css' | asset_url }}"
      media="print"
      onload="this.media='all'">
  </head>
  <body x-init="initScroll()" class="min-h-[100vh] break-words 
    {{ template | handle }}">

    <a href="#root" class="top-4 left-4 color__bg-body focus:translate-y-0 border__button--radius fixed z-50 px-4 py-2 no-underline transform -translate-y-20 shadow-md">
      {{ 'general.accessibility.skip_to_content' | t }}
    </a>

    <header
      class="z-30
      {{ settings.header_position }}
      {% if settings.header_position == 'dynamic' %}sticky top-0 left-0 right-0 animation-300{% endif %} 
      {% if settings.header_position == 'sticky' %}sticky top-0{% endif %}"
      :class="{ 
        '!z-10' : hide_header
      }"
      x-ref="header"
      {% if settings.header_position == 'dynamic' %}
      x-bind:style="is_scrolled ? 
          'transform: translateY(-2rem); opacity: 0; pointer-events: none;' : 
          'transform: none; opacity: 1;'
        "
      {% endif %}>
      {{ locksmith_initializations }}
      {% sections 'header-group' %}
    </header>
    {% section 'theme__cart' %}
    {% section 'theme__menu' %}

    <main id="root" role="main">
      {{ content_for_layout }}
    </main>

    {% sections 'footer-group' %}
    {% sections 'overlay-group' %}

    {% render 'theme__localization-popup' %}
    {% render 'theme__audio-popup' %}
    {% render 'theme__error-popup' %}
    {% render 'assets' with 'main.js' %}
    {% render 'theme__scripts' %}
    <script
      defer
      type="module"
      src="{{ 'nf-dialog.js' | asset_url }}"></script>
    {% unless customer.tags contains 'b2b' or canonical_url contains 'login' or canonical_url contains 'register' %}
      {% render 'nf-dialog' %}
    {% endunless %}

    <script>

      document.addEventListener('DOMContentLoaded', function () {
        const drawer = document.querySelector('#nf_drawer');
        document.body.addEventListener('click', (event) => {
          const closeDrawerButton = event.target.closest('.nf-close-dialog');
          if (closeDrawerButton) {
            drawer.removeAttribute('open');
          }
        });
        document.body.addEventListener('click', (event) => {
          const openDrawerButton = event.target.closest('.nf_show_dialog');
          if (openDrawerButton) {
            drawer.setAttribute('open', '');
          }
        });
        document.querySelector('.nf-drawer').addEventListener('click', (event) => {
          if (event.target === document.querySelector('.nf-drawer')) {
            drawer.removeAttribute('open');
          }
        });
        const tabs = document.querySelectorAll('.tab');
        const contentPanels = document.querySelectorAll('.tab-content');
        tabs.forEach((tab) => {
          tab.addEventListener('click', () => {
            const target = tab.getAttribute('data-target');
            tabs.forEach((t) => t.classList.remove('active'));
            contentPanels.forEach((p) => p.classList.remove('active'));
            tab.classList.add('active');
            document.querySelector(`#${target}`).classList.add('active');
          });
        });

        var dropdown = document.querySelector('.nf-dropdown');
        var content = document.querySelector('.nf-dropdown-content');
        var caret = document.querySelector('.nf-dropdown-caret');
        dropdown.addEventListener('click', function (event) {
          event.stopPropagation();
          content.classList.toggle('active');
          caret.classList.toggle('active');
        });

        document.addEventListener('click', function (event) {
          if (content.classList.contains('active')) {
            content.classList.remove('active');
            caret.classList.remove('active');
          }
        });
        console.log('referrer', document.referrer)
        if (document.referrer.indexOf('/account') !== -1) {
          drawer.setAttribute('open', '');
        }
      });
      var isUserLoggedIn = {{ customer | json }};
      var loggedIn = localStorage.getItem('loggedIn');
      var logoutLink = document.querySelector('.logout_link');
      if (isUserLoggedIn && !loggedIn) {
        document.querySelector('#nf_drawer').setAttribute('open', '');
        localStorage.setItem('loggedIn', 'true');
      } 
      
      logoutLink.addEventListener('click', function (event) {
        localStorage.removeItem('loggedIn');
        console.log('logout__');
      });
    </script>


  </body>

</html>